# Era Mobile - Руководство по запуску

## Описание

Era Mobile - это мобильное приложение для игры "Era of Change", построенное на React Native с поддержкой Expo. Приложение позволяет игрокам аутентифицироваться через QR-коды и взаимодействовать с игровым миром.

## Требования

### Системные требования
- **Node.js**: версия 18.0.0 или выше
- **npm**: версия 8.0.0 или выше
- **Expo CLI**: для разработки и тестирования
- **Rails сервер**: должен быть запущен на `192.168.1.101:3000`

### Мобильные устройства
- **Android**: Android 6.0 (API level 23) или выше
- **iOS**: iOS 11.0 или выше
- **Expo Go**: приложение для тестирования (скачать из App Store/Google Play)

## Установка

### 1. Клонирование и установка зависимостей

```bash
# Перейти в директорию проекта
cd era_mobile

# Установить зависимости
npm install
```

### 2. Установка Expo CLI (если не установлен)

```bash
# Глобальная установка Expo CLI
npm install -g @expo/cli

# Или через npx (рекомендуется)
npx expo --version
```

## Запуск

### 1. Запуск Rails сервера

Перед запуском мобильного приложения необходимо запустить Rails сервер:

```bash
# Перейти в директорию Rails приложения
cd ../eraofchange

# Запустить сервер
rails server -b 0.0.0.0 -p 3000
```

Сервер должен быть доступен по адресу `http://192.168.1.101:3000`

### 2. Запуск мобильного приложения

```bash
# В директории era_mobile
npm start
```

После запуска откроется Expo DevTools в браузере с QR-кодом для подключения.

## Тестирование

### Через Expo Go (рекомендуется)

1. **Установите Expo Go** на мобильное устройство:
   - [Android](https://play.google.com/store/apps/details?id=host.exp.exponent)
   - [iOS](https://apps.apple.com/app/expo-go/id982107779)

2. **Отсканируйте QR-код** из консоли, где запущен сервер era_mobile (Expo DevTools)

3. **Приложение загрузится** на устройство

### Через веб-браузер

```bash
# Запуск веб-версии
npm run web
```

Приложение откроется в браузере по адресу `http://localhost:8081`

## Аутентификация

### QR-код аутентификация

1. **Откройте веб-приложение** `era_front` в браузере
2. **Перейдите на вкладку "Игроки"**
3. **Отсканируйте QR-код** нужного игрока в мобильном приложении
4. **Автоматический вход** в систему

### Ручной ввод идентификатора

1. **Нажмите "Ввести вручную"** на экране входа
2. **Введите identificator** игрока (например: `A1B2C3D4`)
3. **Нажмите "Войти"**

## Структура проекта

```
era_mobile/
├── App.tsx                 # Главный компонент приложения
├── api.ts                  # API сервис для работы с Rails
├── LoginScreen.tsx         # Экран входа
├── QRCodeScanner.tsx       # Компонент сканирования QR-кодов
├── DashboardScreen.tsx     # Главный экран после входа
├── package.json            # Зависимости проекта
├── app.json               # Конфигурация Expo
└── GETTING_STARTED.md     # Этот файл
```

## API Endpoints

Приложение использует следующие API endpoints:

- `POST /auth/login` - аутентификация игрока
- `POST /auth/logout` - выход из системы
- `GET /auth/current_player` - получение текущего игрока
- `GET /auth/generate_qr/:id` - генерация QR-кода для игрока

## Настройка сети

### Для локальной разработки

Убедитесь, что:
- Rails сервер запущен на `192.168.1.101:3000`
- Мобильное устройство и компьютер в одной сети
- CORS настроен в Rails для мобильного приложения

### Для продакшена

Обновите `API_BASE_URL` в файле `api.ts`:

```typescript
const API_BASE_URL = 'https://your-production-domain.com';
```

## Отладка

### Логи в Expo Go

1. **Встряхните устройство** для открытия меню разработчика
2. **Выберите "Debug Remote JS"** для просмотра логов в браузере
3. **Или выберите "Show Perf Monitor"** для мониторинга производительности

### Логи в браузере

Откройте Developer Tools (F12) в браузере для просмотра логов веб-версии.

## Возможные проблемы

### Network Error

- **Проверьте** что Rails сервер запущен
- **Убедитесь** что IP адрес правильный в `api.ts`
- **Проверьте** CORS настройки в Rails

### QR-код не сканируется

- **Убедитесь** что камера разрешена в настройках устройства
- **Проверьте** что QR-код четкий и хорошо освещен
- **Попробуйте** ручной ввод идентификатора

### Приложение не запускается

- **Очистите кэш**: `npm start -- --clear`
- **Переустановите зависимости**: `rm -rf node_modules && npm install`
- **Проверьте версию Node.js**: `node --version`

## Дополнительные команды

```bash
# Очистка кэша и перезапуск
npm start -- --clear

# Запуск только веб-версии
npm run web

# Запуск только Android
npm run android

# Запуск только iOS
npm run ios

# Сборка для продакшена
npm run build
```

## Поддержка

При возникновении проблем:
1. Проверьте логи в Expo DevTools
2. Убедитесь что все зависимости установлены
3. Проверьте настройки сети и CORS
4. Обратитесь к документации Expo: https://docs.expo.dev/
